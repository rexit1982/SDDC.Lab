##
##      Project: SDDC.Lab
##      Authors: Luis Chanu & Rutger Blom
##     Filename: playbooks/DeployGenericVms.yml
##
##  Description: This playbook acts as a wrapper.  It loops through the VMs datastructure, provisioning 
##               each VM, one-by-one, by "sending" the VM object to the "Include_Tasks_DeployGenericVm.yml" playbook.
##               That playbook does all of the "heavy liftings" and includes ALL of the tasks needed to provision a 
##               given VM.  That includes not only installing the OS, but also configuring it once deployed, per the 
##               settings in the VM data structure).
##
##               There is no option whether or not to power-on the VM, as all VMs are powered-on so that the OS can
##               be installed, and tasks run.
##
##    Variables: As the VM structure is currently not "extended" (or added to) by CreatePodConfig.yml like the Deploy
##               structure is, we need to (for now) include the software.yml and templates.yml files so that
##               we can determine software path, installation file, and templates at runtime.  Should the
##               playbook be brought into SDDC.Lab, then we can see at possibly updating the VM structure then.
##

##
## ToDo Items:
##   1) Add Ubuntu section in Templates.yml for different versions of Ubuntu.
##   2) Look at 'minimal' install flag in Cloud-Init template
##
---
- name: DeployGenericVms.yml
  hosts: localhost
  vars_files:
    - ../software.yml
    - ../templates.yml
  vars:
##
## VM datastructure, which is a list of VMs, consumed by 'Include_Tasks_DeployGenericVm'
##
#   TODO: Update descriptions to identify which are OPTIONAL or REQUIRED, Default value, and possible values.
    VMs:
      - VMName: Pod-010-DNS-Test                                      # OPTIONAL - If not specified, the following is used:  "{{ SiteCode }}-{{ item.Software.Vendor }}-{{ item.Software.Product}}-{{ item.Software.Version}}-VM-{{ '%03d'|format(loop_idx+1|int) }}"
        Deploy: true                                                  # REQUIRED - Boolean to control if the VM is to be deployed or not
        Deployment:
          Target: NESTED                                              # REQUIRED - Options: PHYSICAL, NESTED
          Cluster: ComputeA                                           # Only applicable for NESTED
          VMFolder:                                                   # Only applicable for NESTED
          UpdateDNS: true                                             # REQUIRED - Only the first interface is added to DNS, and it must be configured as a static IP.  DHCP is not added to DNS.
          RemoveCDROMDevice: true                                     # REQUIRED - Boolean control if the CDROM is removed from the VM Hardware after deployment
        Software:
          Vendor: Ubuntu                                              # REQUIRED
          Product: Server                                             # REQUIRED
          Version: "24.04"                                            # REQUIRED - Must be a string (i.e., Surrounded by quotes)
        Annotation: "{{ Common.Annotation }}"
        VMOptions:
          GeneralOptions:
            GuestOS: ubuntu64Guest                                    # REQUIRED - Options: Any supported Guest OS Customization Type
          BootOptions:
            Firmware: efi                                             # REQUIRED - Options: bios, efi
        HardwareSettings:
          Version:                                                    # OPTIONAL - Options: Virtual Machine HW version number or 'latest'.  If not specified, 'latest' will be used.
          NestedVirtualization: true                                  # REQUIRED - Options: true, false.  Boolean to control the enabling of nested virtualization support.
          CPU:
            Quantity: 2
            CoresPerSocket: 2
            Reservation: 0
            SharesLevel:                                              # OPTIONAL - Options: low, normal, high.   If not specified, 'normal' will be used.
            AllowHotAdd:                                              # OPTIONAL - Options: true, false.   If not specified, 'false' will be used.  Boolean to control whether to allow virtual CPUs to be added while VM is running.
            AllowHotRemove:                                           # OPTIONAL - Options: true, false.   If not specified, 'false' will be used.  Boolean to control whether to allow virtual CPUs to be removed while VM is running.
          Memory:
            Size: 4096                                                # REQUIRED - Memory size to provision in MB.
            Reservation:                                              # OPTIONAL - Memory to reserve in MB.  If not specified, '0' will be used.
            SharesLevel:                                              # OPTIONAL - Options: low, normal, high.   If not specified, 'normal' will be used.
            AllowHotAdd:                                              # OPTIONAL - Options: true, false.   If not specified, 'false' will be used.  Boolean to control whether to allow virtual memory to be added while VM is running.
          Storage:
            Controller:                                               # OPTIONAL - SCSI Controller options: paravirtual, buslogic, lsilogic, lsilogicsas.  If not specified, 'paravirtual' will be used.
            Disks:
              - Size: 20                                              # REQUIRED - Disk size to provision in GB.
                DiskProvisioning: "{{ Common.DiskProvisioning }}"     # REQUIRED - Options: thin, thick.   Default will be the 'Common.DiskProvisioning' setting.
                Controller:
                  Type:                                               # OPTIONAL - Options: paravirtual, buslogic, lsilogic, lsilogicsas, sata, nvme
                  Number:                                             # OPTIONAL - If not specified, it is auto assigned.  Note: Number 7 cannot be used if SCSI controller is specified.
          Network:
            Adapters:
              - PortGroup: SEG-Web                                    # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: true
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
        NSXT:
          Tags:
            - Tag: Auto-Deployed
              Scope: SDDC.Lab
            - Tag: DNS
              Scope: SDDC.Lab
        OS:
          Credential:
            User: ubuntu
            Password: "{{ Common.Password.Nested }}"
          Locale: en_US
          Keyboard:
            Layout: us
            Variant: intl
          Network:
            DNS:
              Domain: "{{ Common.DNS.Domain }}"
              Servers:                                                # List of DNS Servers
                - "{{ Common.DNS.Server1.IPv4 }}"
                - "{{ Common.DNS.Server1.IPv6 }}"
            Adapters:
              - IPv4:
                  Address: 10.204.10.10                               # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix: 24                                          # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway: 10.204.10.1                                # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address: fc00:0:0:a::a                              # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix: 64                                          # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
          PostInstall:
            SSH:
              Server:
                Install: true                                         # REQUIRED - Options: true, false.   Indicates whether to install SSH Server VM provisioning.
                AllowPW: true                                         # REQUIRED - Options: true, false.   Indicates whether to allow passwords for SSH Server authentication.
            Directories:
              - Name: LogDir                                          # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Path: /var/log/named                                  # REQUIRED - Absolute path of the directory which needs to be created.
                Owner: bind:bind                                      # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the directory to.  If not specified, directory permissions are not changed.
            Templates:                                                #---------All template filenames must be unique
              - Name: BINDNamedConf                                   # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source: "{{ Target.TemplateFolder }}/BIND_v9_named.conf"     # REQUIRED - Source Jinja2 template is specified here
                Destination: /etc/bind/named.conf                     # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
              - Name: BINDNamedConfOptions                            # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source: "{{ Target.TemplateFolder }}/BIND_v9_named.conf.options.j2"     # REQUIRED - Source Jinja2 template is specified here
                Destination: /etc/bind/named.conf.options             # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
              - Name: BINDNamedConfLocal                              # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source: "{{ Target.TemplateFolder }}/BIND_v9_named.conf.local.j2"      # REQUIRED - Source Jinja2 template is specified here
                Destination: /etc/bind/named.conf.local               # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
              - Name: BINDForwardZone                                 # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source: "{{ Target.TemplateFolder }}/BIND_v9_db.forwardzone.j2"     # REQUIRED - Source Jinja2 template is specified here
                Destination: "/var/lib/bind/db.{{ Common.DNS.Domain | lower }}"     # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
              - Name: BINDReverseZoneIPv4                             # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source: "{{ Target.TemplateFolder }}/BIND_v9_db.reversezoneipv4.j2"     # REQUIRED - Source Jinja2 template is specified here
                Destination: "/var/lib/bind/db.{{ Pod.BaseNetwork.IPv4 }}"              # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
              - Name: BINDReverseZoneIPv6                             # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source: "{{ Target.TemplateFolder }}/BIND_v9_db.reversezoneipv6.j2"     # REQUIRED - Source Jinja2 template is specified here
                Destination: /var/lib/bind/db.fd                      # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
              - Name:                                                 # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source:                                               # REQUIRED - Source Jinja2 template is specified here
                Destination:                                          # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
            Packages:
              - bind9
              - bind9-doc
              - bind9-utils
              - dns-root-data
              - ntp
              - ntpstat
              - wget
            Commands:                                                 # OPTIONAL - List of commands to run post install to configure the VM.  These commands are run using 'sudo'.
              Before:                                                 #---------These commands are executed after provisioning of the VM, but BEFORE any of the group, package, or template VM-specific actions are performed.
                -                                                     # OPTIONAL - List of commands to run.   If no command, must leave an empty list, which is just a single '-'.
              After:                                                  #---------These commands are executed after provisioning of the VM, and AFTER  all of the group, package, or template VM-specific actions are performed.
                - ls                                                  # OPTIONAL - List of commands to run.   If no command, must leave an empty list, which is just a single '-'.
      - VMName:                                                       # OPTIONAL - If not specified, the following is used:  "{{ SiteCode }}-{{ item.Software.Vendor }}-{{ item.Software.Product}}-{{ item.Software.Version}}-VM-{{ '%03d'|format(loop_idx+1|int) }}"
        Deploy: false                                                 # REQUIRED - Boolean to control if the VM is to be deployed or not
        Deployment:
          Target: NESTED                                              # REQUIRED - Options: PHYSICAL, NESTED
          Cluster: ComputeA                                           # Only applicable for NESTED
          VMFolder:                                                   # Only applicable for NESTED
          UpdateDNS: true                                             # REQUIRED - Only the first interface is added to DNS, and it must be configured as a static IP.  DHCP is not added to DNS.
          RemoveCDROMDevice: true                                     # REQUIRED - Boolean control if the CDROM is removed from the VM Hardware after deployment
        Software:
          Vendor: Ubuntu                                              # REQUIRED
          Product: Server                                             # REQUIRED
          Version: "24.04"                                            # REQUIRED - Must be a string (i.e., Surrounded by quotes)
        Annotation: "{{ Common.Annotation }}"
        VMOptions:
          GeneralOptions:
            GuestOS: ubuntu64Guest                                    # REQUIRED - Options: Any supported Guest OS Customization Type
          BootOptions:
            Firmware: bios                                            # REQUIRED - Options: bios, efi
        HardwareSettings:
          Version: latest                                             # OPTIONAL - Options: Virtual Machine HW version number or 'latest'.  If not specified, 'latest' will be used.
          NestedVirtualization: true                                  # REQUIRED - Options: true, false.  Boolean to control the enabling of nested virtualization support.
          CPU:
            Quantity: 2
            CoresPerSocket: 2
            Reservation: 0
            SharesLevel: normal                                       # OPTIONAL - Options: low, normal, high.   If not specified, 'normal' will be used.
            AllowHotAdd: false                                        # OPTIONAL - Options: true, false.   If not specified, 'false' will be used.  Boolean to control whether to allow virtual CPUs to be added while VM is running.
            AllowHotRemove: false                                     # OPTIONAL - Options: true, false.   If not specified, 'false' will be used.  Boolean to control whether to allow virtual CPUs to be removed while VM is running.
          Memory:
            Size: 4096                                                # REQUIRED - Memory size to provision in MB.
            Reservation: 0                                            # OPTIONAL - Memory to reserve in MB.  If not specified, '0' will be used.
            SharesLevel: normal                                       # OPTIONAL - Options: low, normal, high.   If not specified, 'normal' will be used.
            AllowHotAdd: false                                        # OPTIONAL - Options: true, false.   If not specified, 'false' will be used.  Boolean to control whether to allow virtual memory to be added while VM is running.
          Storage:
            Controller: paravirtual                                   # OPTIONAL - SCSI Controller options: paravirtual, buslogic, lsilogic, lsilogicsas.  If not specified, 'paravirtual' will be used.
            Disks:
              - Size: 10                                              # REQUIRED - Disk size to provision in GB.
                DiskProvisioning: "{{ Common.DiskProvisioning }}"     # REQUIRED - Options: thin, thick.   Default will be the 'Common.DiskProvisioning' setting.
                Controller:
                  Type: paravirtual                                   # OPTIONAL - Options: paravirtual, buslogic, lsilogic, lsilogicsas, sata, nvme
                  Number:                                             # OPTIONAL - If not specified, it is auto assigned.  Note: Number 7 cannot be used if SCSI controller is specified.
          Network:
            Adapters:
              - PortGroup: SEG-Web                                    # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: true
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
              - PortGroup:                                            # REQUIRED - PortGroup name to attach to.  If not specified, PortGroup will be skipped and not provisioned.
                DeviceType: vmxnet3                                   # REQUIRED - Options: e1000, e1000e, pcnet32, vmxnet2, vmxnet3, sriov
                StartConnected: false
        NSXT:
          Tags:
            - Tag: Auto-Deployed
              Scope: SDDC.Lab
        OS:
          Credential:
            User: ubuntu
            Password: "{{ Common.Password.Nested }}"
          Locale: en_US
          Keyboard:
            Layout: us
            Variant: intl
          Network:
            DNS:
              Domain: "{{ Common.DNS.Domain }}"
              Servers:                                                # List of DNS Servers
                - "{{ Common.DNS.Server1.IPv4 }}"
                - "{{ Common.DNS.Server1.IPv6 }}"
            Adapters:
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
              - IPv4:
                  Address:                                            # REQUIRED - Enter IPv4 address.  If not specified, then IPv4 address will be obtained via DHCPv4.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 24).  Not required for DHCPv4.
                  Gateway:                                            # REQUIRED - Enter IPv4 default gateway.  Not required for DHCPv4
                IPv6:
                  Address:                                            # REQUIRED - Enter IPv6 address in quotes.  If not specified, then IPv6 address will be obtained via SLAAC/DHCPv6.
                  Prefix:                                             # REQUIRED - Enter network prefix size (i.e. 64).  Not required for SLAAC/DHCPv6.
                  Gateway:                                            # OPTIONAL - Enter IPv6 default gateway.  Not required as VM should learn IPv6 gateway via router advertisements.
          PostInstall:
            SSH:
              Server:
                Install: true                                         # REQUIRED - Options: true, false.   Indicates whether to install SSH Server VM provisioning.
                AllowPW: true                                         # REQUIRED - Options: true, false.   Indicates whether to allow passwords for SSH Server authentication.
            Directories:
              - Name:                                                 # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Path:                                                 # REQUIRED - Absolute path of the directory which needs to be created.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the directory to.  If not specified, directory permissions are not changed.
            Templates:                                                #---------All template filenames must be unique
              - Name:                                                 # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source:                                               # REQUIRED - Source Jinja2 template is specified here
                FinalDestination:                                     # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
              - Name:                                                 # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source:                                               # REQUIRED - Source Jinja2 template is specified here
                FinalDestination:                                     # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
              - Name:                                                 # REQUIRED - Descriptive name for template entry.  If not specified, entry will be skipped
                Source:                                               # REQUIRED - Source Jinja2 template is specified here
                FinalDestination:                                     # REQUIRED - Final location within the VM where the rendered template will be copied to.  Must be an absolute path.
                Owner:                                                # OPTIONAL - Linux user to change the owner to.  If not specified, no ownership changes are made.
                Permissions:                                          # OPTIONAL - Linux file mode bit permissions to set the file to.  If not specified, file permissions are not changed.
            Packages:
              - traceroute
              - dnsutils
            Commands:                                                 # OPTIONAL - List of commands to run post install to configure the VM.  These commands are run using 'sudo'.
              Before:                                                 #---------These commands are executed after provisioning of the VM, but BEFORE any of the group, package, or template VM-specific actions are performed.
                -
              After:                                                  #---------These commands are executed after provisioning of the VM, and AFTER  all of the group, package, or template VM-specific actions are performed.
                - ls


  tasks:
    - name: DeployGenericVm_Playbook
      ansible.builtin.debug:
        msg: "Starting playbook: {{ ansible_play_name }}"

    - name: Display error message if Pod-XXX-Config file is not valid or provided
      ansible.builtin.pause:
        seconds: 5
        prompt: |
          *****************************************************************************************************
          ****************************************** ERROR MESSAGE ********************************************
          *****************************************************************************************************

            A valid "Pod-XXX-Config.yml" file is required in order for this playbook to run.

            Please verify:
            ==============
              1) You supplied a valid Pod-XXX-Config.yml file via the ansible-playbook -e "@Pod-XXX-Config.yml"
                 command-line option.  Here is an example of a how to load a Pod-XXX-Config.yml file that is
                 located in your home directory:
                                    ansible-playbook -e "@~/Pod-XXX-Config.yml" Deploy.yml

              2) The Pod-XXX-Config.yml file provided was created using the playbooks/CreatePodConfig.yml script.
                 All Pod configuration files used to deploy labs MUST be generated using that script.

              3) You included the proper path with the "-e" option to the Pod-XXX-Config.yml file.

              4) You prefaced the file name in the "-e" option with a '@', as shown in the example above.

          *****************************************************************************************************
      when:
        - Valid_Pod_Config_File is not defined

    - name: Exit Ansible playbook if Pod-XXX-Config.yml file is not valid or provided
      ansible.builtin.meta: end_play
      when: 
        - Valid_Pod_Config_File is not defined

    - name: DEBUG -- Display Target Variables (Pause)
      ansible.builtin.pause:
        seconds: "{{ DEBUG.DisplayDelayInSeconds }}"
        prompt: |
          ================================ Display Variables For Pod {{ '%03d' | format(Pod.Number | int) }} ==================================

                                             Ansible Playbook: {{ ansible_play_name }}

                                            Target.Deployment: {{ Target.Deployment }}

                              Number of Generic VMs to deploy: {{ VMs | length }}

          =================================================================================================
      when:
        - DEBUG.DisplayVariables


##
## Provision Workload VMs
##
    - name: Provision VMs one at a time
      ansible.builtin.include_tasks:
        file: Include_Tasks_DeployGenericVm.yml
      loop: "{{ VMs }}"
      loop_control:
        index_var: loop_idx
      when:
        - VMs is defined
        - VMs | length > 0
        - item.Deploy
